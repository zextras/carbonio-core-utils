#!/bin/bash

advanced_status() {
    local services=("admin" "auth" "backup" "chats" "core" "powerstore")

    for service in "${services[@]}"; do
        output=$(carbonio "$service" getServices)
        is_module_section=false

        while IFS= read -r line; do
            if [[ $line =~ module ]]; then
                is_module_section=true
            elif $is_module_section && [[ $line =~ running[[:space:]]+([a-zA-Z]+) ]]; then
                running_status="${BASH_REMATCH[1]}"
                if [[ $running_status == "true" ]]; then
                    status=$(printf "\t%-20s %10s\n" "$service" "Running")
                else
                    status=$(printf "\t%-20s %10s\n" "$service" "Stopped (to start module run 'carbonio $service doRestartService module')")
                fi
                echo "$status"
                break
            fi
        done <<< "$output"
    done
}

exists_command() {
    command -v "$1" >/dev/null 2>&1

    if [[ $? -eq 0 ]]; then
        echo "true"
    else
        echo "false"
    fi
}